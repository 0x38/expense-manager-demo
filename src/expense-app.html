<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/polymer/lib/utils/flattened-nodes-observer.html">
<link rel="import" href="login-page.html">
<link rel="lazy-import" href="overview-page.html">

<dom-module id="expense-app">
  <template>
    <style>
       :host {
        display: block;
      }

      #pages,
      #pages>* {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

       :host>* {
        --dark-primary-color: #33383a;
        --primary-color: #00b4f0;
        --light-primary-color: #F2FAF9;
        --text-primary-color: #FFFFFF;
        --accent-color: #ff3a39;
        --light-accent-color: #F2FAF9;
        --primary-text-color: rgba(0, 0, 0, 0.87);
        --secondary-text-color: #727272;
        --primary-background-color: #FFFFFF;
        --disabled-text-color: #BDBDBD;
        --divider-color: #B6B6B6;
        --paper-menu-background-color: #fff;
        --menu-link-color: #111111;
        --paper-input-container-underline: {
          background: #dbdbdb;
        }
        --paper-header-panel-shadow: {
          display: none;
        }
        --paper-header-panel-standard-container: {
          overflow: visible;
        }
        --vaadin-upload-button-add: {
          background: transparent;
          color: var(--primary-color);
          box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        }
        --vaadin-upload-buttons-primary: {
          flex-direction: column;
          align-items: center;
        }
        --section-title: {
          font-weight: 400;
          font-size: 13px;
          display: block;
          border-bottom: 1px solid rgba(0, 0, 0, 0.13);
          padding-bottom: 6px;
          margin-bottom: 18px;
          margin-top: 4px;
          color: rgba(0, 0, 0, 0.54);
        }
        iron-overlay-backdrop {
          --iron-overlay-backdrop-background-color: #33383A;
        }

        --paper-input-container-underline: {
          border-color: rgba(0, 0, 0, 0.2);
        }
      }

    </style>

    <iron-pages id="pages" selected="[[selected]]" selected-attribute="active">
      <login-page id="login" on-log-in="_logIn"></login-page>
      <overview-page id="overview" on-log-out="_logOut"></overview-page>
    </iron-pages>

  </template>

  <script>
    class ExpenseApp extends Polymer.Element {
      static get is() {
        return 'expense-app'
      };

      static get properties() {
        return {
          loggedIn: {
            type: Boolean,
            value: function () {
              return !!window.localStorage.getItem('expense-manager-db-id');
            },
            notify: true,
            observer: '_selectPage'
          },
          selected: {
            type: Number,
            notify: true
          }
        };
      }

      _logIn() {
        this.loggedIn = true;
      }

      _logOut() {
        this.loggedIn = false;
      }

      _selectPage() {
        if (this.loggedIn !== undefined) {
          this.selected = this.loggedIn ? 1 : 0;
          if (this.selected) {
            this._lazyLoadMainPage();
          }
        }
      }

      _lazyLoadMainPage() {
        Polymer.RenderStatus.afterNextRender(this, () => {
          Polymer.importHref(
            this.resolveUrl('overview-page.html'), null, null, true);
        });
      }
    }

    window.customElements.define(ExpenseApp.is, ExpenseApp);

  </script>
</dom-module>
